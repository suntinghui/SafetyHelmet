<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>安全帽状态</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/view.css" />

		<style>
			.item-div {
				margin: 10px auto;
				display: -webkit-box;
				-webkit-box-pack: center;
				-webkit-box-align: center;
			}
			
			.item-name {
				width: 25%;
				color: #666666;
				font-size: 16px;
				text-align: right;
			}
			
			.item-value {
				margin-left: 20px;
				width: 75%;
				color: #333333;
				font-size: 16px;
			}
			
			.filelink {
				color: #6699FF;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav navbar">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left backbtn"></a>
			<h1 id="title" class="mui-title">安全帽状态</h1>
		</header>

		<div class="mui-content">
			<div class="mui-scroll mui-card">
				<ul class="mui-table-view" id="list">
				</ul>
			</div>

		</div>

		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/constants.js"></script>
		<script type="text/javascript" src="../js/util.js"></script>
		<script type="text/javascript" src="../js/view.js"></script>

		<script type="text/javascript">
			mui.init();

			mui('.scroll-content').scroll({
				indicators: true //是否显示滚动条
			});

			window.onload = function() {
				requestList();
			};

			function requestList() {
				checkNetwork();

				mui.plusReady(function() {
					plus.nativeUI.showWaiting("正在请求数据...");

					var arg = {
						channel: getChannel(),
						page: '1',
						pageCount: MAX_PAGE_SIZE,
						fullName: '',
						helmetColor: '',
						helmetType: '',
						wearStatus: '',
					}

					var url = getHost() + "helmetInfo/selectAqmMsg.action?arg=" + JSON.stringify(arg);
					console.log(url);

					mui.ajax(url, {
						dataType: 'json',
						type: 'get',
						timeout: TIMEOUT,
						headers: {
							'Content-Type': 'application/json'
						},
						success: function(data) {
							plus.nativeUI.closeWaiting();

							responseList(data);
						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();

							mui.toast(getHttpErrorDesp(type));
						}
					});
				});
			}

			function responseList(resp) {
				if(resp.respMsgCode != '00') {
					mui.alert(resp.respMSG);
					return;
				}

				var list = document.getElementById("list");
				// 首先清空下面的所有结点
				while(list.hasChildNodes()) {
					list.removeChild(list.firstChild);
				}
				// 开始添加新的节点
				var fragment = document.createDocumentFragment();
				var li;
				for(var i = 0; i < resp.dataList.length; i++) {
					var record = resp.dataList[i];
					li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.id = i + "";

					var a = document.createElement('a');
					a.className = 'mui-navigate-right';

					a.appendChild(createInfoItem('帽子型号', record.helmettype, 'other'));
					a.appendChild(createInfoItem('穿戴状态', (record.wearstatus == '0' ? '未穿戴' : '已穿戴'), 'other'));
					a.appendChild(createInfoItem('穿戴人', record.fullname, 'other'));
					a.appendChild(createInfoItem('实时位置', '点击查看', 'filelink currentLocation'));
					a.appendChild(createInfoItem('剩余电量', record.dumpenergy + '%', 'other'));

					li.appendChild(a);
					fragment.appendChild(li);
				}
				list.appendChild(fragment);
			}

			mui('#list').on('tap', '.currentLocation', function(e) {
				mui.openWindow({
					id: Math.random() + '',
					url: 'showMyLocation.html',
					preload: true,
					show: {
						aniShow: 'pop-in'
					},
				});
			});

			mui('#list').on('tap', '.other', function(e) {
				if(menuState() == true) {
					mui.fire(mui.currentWebview.opener(), "menu:close");
					return;
				}

				mui.openWindow({
					id: Math.random() + '',
					url: 'helmetDetail.html',
					preload: true,
					show: {
						aniShow: 'pop-in'
					},
				});
			});
		</script>
	</body>

</html>